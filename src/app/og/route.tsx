import { ImageResponse } from "next/og";
import { siteConfig } from "@/config/site";

const font = fetch(
  new URL("../../assets/fonts/Inter-Regular.ttf", import.meta.url)
).then((res) => res.arrayBuffer());

export const runtime = "edge";

export async function GET(request: Request) {
  let url = new URL(request.url);
  let title = url.searchParams.get("title") || siteConfig.title;

  const fontData = await font;

  // we also need to decode the title to avoid encoding issues
  title = decodeURIComponent(title);

  console.log(title);
  return new ImageResponse(
    (
      <div
        tw="flex flex-col p-12 w-full h-full rounded-3xl"
        style={{
          background: "linear-gradient(60deg, #00356a 0%, #bf83fc 100%)",
        }}
      >
        <div
          tw="flex flex-col flex-1 w-full h-full"
          style={{
            fontFamily: "Inter",
            fontStyle: "normal",
            color: "white",
          }}
        >
          <div tw="flex flex-col flex-1 justify-between">
            <div tw="flex p-4">
              <svg
                width="341"
                height="120"
                viewBox="0 0 341 120"
                fill="#bf83fc"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M0 60C0 26.8629 26.8629 0 60 0H281C314.137 0 341 26.8629 341 60V60C341 93.1371 314.137 120 281 120H60C26.8629 120 0 93.1371 0 60V60Z"
                  fill="#D9D9D9"
                />
                <path
                  d="M288.659 27.5734C288.917 29.8492 289.102 31.9949 289.213 34.0106C289.296 36.1291 289.306 38.1177 289.371 39.9003C287.42 40.7014 285.275 41.0094 283.14 40.8785C282.412 36.7116 282.116 32.5503 282.253 28.3945C284.553 27.9078 286.67 27.7027 288.659 27.5734ZM301.287 27.4267C303.634 28.3867 305.669 29.7041 307.188 31.3248C305.385 33.5998 302.164 37.9223 297.426 44.2652C300.492 46.1899 303.456 48.0875 306.319 49.9579C305.16 51.8538 303.927 53.6197 302.648 55.1526C299.426 53.4066 296.361 51.4819 293.654 49.4327C292.633 50.814 291.639 52.0923 290.774 53.2948C288.657 52.2862 286.825 51.023 285.379 49.5324C288.949 43.0969 294.294 35.7031 301.287 27.4267ZM311.994 36.474C314.259 37.7428 315.907 39.2877 316.883 41.3145C314.334 43.9414 311.077 46.3783 306.982 48.7011C304.864 47.6925 303.52 46.229 302.847 44.2836C305.092 41.5753 308.175 38.9812 311.994 36.474ZM251.028 16.9388C251.314 19.1116 251.628 21.1815 251.895 23.0184C252.006 25.0341 252.172 26.8438 252.265 28.5235C250.314 29.3247 248.169 29.6327 245.933 29.4746C244.993 25.6923 244.54 21.7097 244.521 17.7327C246.923 17.2731 249.04 17.068 251.028 16.9388ZM265.865 15.8393C268.212 16.7993 270.146 18.0896 271.665 19.7102C269.908 22.2182 266.651 27.0825 261.922 34.2003C265.291 36.2064 268.633 38.3154 271.901 40.2944C270.742 42.1903 269.611 43.9833 268.332 45.5162C264.603 43.6345 261.206 41.7314 258.168 39.7038C257.46 40.7275 256.751 41.7513 256.043 42.7751C253.926 41.7664 252.066 40.6062 250.621 39.1156C254.07 32.317 259.195 24.533 265.865 15.8393ZM274.271 24.1597C276.536 25.4284 278.055 27.0491 279.059 28.973C276.915 31.7084 274.136 34.3839 270.851 36.9238C268.734 35.9151 267.288 34.4245 266.689 32.6092C268.529 29.7924 271.133 26.9597 274.271 24.1597ZM244.161 43.7836C245.274 44.082 246.232 44.5592 247.134 45.2423C245.672 50.6979 243.539 56.6355 240.706 63.158C239.813 63.2497 238.671 63.0542 237.153 62.6473C235.634 62.2403 234.676 61.7631 234.234 60.9827C236.386 52.9537 238.519 47.0161 240.764 43.0941C241.703 43.2354 242.844 43.4309 244.161 43.7836ZM253.697 45.4562C272.328 50.4484 290.563 56.1068 308.302 62.4045C307.494 68.2559 306.464 73.7171 305.085 78.8639C304.395 79.0099 303.355 78.8416 302.14 78.516C301.33 78.2989 300.216 78.0005 298.955 77.4419C298.927 75.1174 299.358 71.482 300.148 66.5083C284.15 62.2215 268.114 57.2629 252.272 51.5837C252.189 50.6788 252.391 49.5194 252.722 48.2841C252.943 47.4607 253.218 46.4313 253.697 45.4562ZM253.699 82.3059C267.875 86.1043 278.562 89.9609 285.687 93.7457C285.513 96.0158 285.026 98.6435 284.254 101.526C283.454 104.511 282.598 106.488 281.761 107.588C278.07 107.592 270.743 106.18 259.909 103.277C248.366 100.184 241.37 97.5372 239.022 95.3635C239.389 92.3728 239.904 89.6422 240.511 87.3776C240.979 85.6277 241.559 83.466 242.451 80.9469C243.518 81.0123 244.485 81.0506 245.497 81.3219C246.712 81.6475 247.697 82.0218 248.277 82.2875C247.699 86.8765 247.249 90.1761 246.697 92.2348C250.03 93.569 255.01 95.2344 261.49 96.9708C269.185 99.0328 274.478 100.341 277.341 100.997C277.829 99.5835 278.261 98.3753 278.592 97.1401C276.318 96.3102 267.499 93.175 252.182 87.9674C252.2 87.0896 252.476 86.0603 252.779 84.928C253 84.1045 253.248 83.178 253.699 82.3059ZM262.215 60.647C271.126 63.0345 280.81 66.181 291.368 70.1134C291.7 71.3055 291.397 73.6515 290.404 77.3572C289.246 81.6806 288.197 84.3785 287.259 85.4509C283.779 85.0702 275.725 83.1327 262.967 79.7142C255.778 77.7879 250.724 75.9924 247.934 74.252C247.934 71.8247 248.292 69.2728 249.009 66.5965C249.671 64.126 250.664 61.634 252.191 59.1747C253.057 59.1859 254.023 59.2242 255.036 59.4955C256.048 59.7668 257.006 60.244 257.76 60.6669L255.223 70.137C263.314 72.7464 272.372 75.3941 282.498 78.1073C282.958 76.7962 283.417 75.4852 283.748 74.2499C275.252 71.532 267.446 68.6681 260.404 65.7882L261.148 63.0089C261.369 62.1854 261.691 61.3891 262.215 60.647Z"
                  fill="#bf83fc"
                />
                <path
                  d="M149.42 22.488C165.836 23.064 182.444 23.832 199.34 24.696V27.48C199.34 29.016 199.148 30.168 198.956 31.128C182.444 30.936 165.836 30.264 148.94 28.92C148.652 28.152 148.556 27 148.556 25.56C148.556 24.504 148.844 23.448 149.42 22.488ZM149.804 31.608C150.764 31.8 151.82 31.896 152.876 31.992C152.684 44.088 152.204 55.992 151.436 67.8C170.636 67.992 187.82 68.376 203.084 68.952C204.044 78.168 204.62 87.288 204.62 96.504C202.7 96.696 200.3 96.888 197.516 96.888C194.828 96.696 192.812 96.504 191.468 96.216V91.608H198.38C197.804 86.136 197.516 80.568 197.324 75C180.428 75 162.956 74.424 144.908 73.272C145.004 59.448 145.868 45.624 147.404 31.8C148.172 31.704 148.94 31.608 149.804 31.608ZM163.34 39.576C167.084 39.576 171.116 39.672 175.34 39.768C175.34 38.424 175.436 37.08 175.532 35.928C176.492 35.832 177.644 35.736 178.988 35.736C180.14 35.736 181.292 35.928 182.252 36.312V40.056C186.092 40.248 190.028 40.44 194.06 40.632C194.06 42.552 193.868 44.568 193.484 46.68C189.548 46.68 185.804 46.68 182.156 46.488C182.06 48.6 182.06 50.712 182.06 52.824C187.052 52.92 191.084 53.112 194.156 53.496C194.348 54.072 194.444 55.032 194.444 56.184C194.444 57.624 194.348 58.584 194.156 58.968C193.388 59.256 189.26 59.352 181.868 59.352C181.772 60.888 181.676 62.328 181.676 63.672C180.908 63.96 179.756 64.056 178.22 64.056C176.684 64.056 175.532 63.768 174.956 63.192V59.352C167.276 59.352 162.956 59.16 162.092 58.968C161.9 58.2 161.804 57.24 161.804 55.992C161.804 55.032 161.9 54.072 162.284 53.208C166.22 53.016 170.444 52.92 175.052 52.824C175.052 50.52 175.052 48.312 175.148 46.2C171.02 46.008 166.988 45.816 163.148 45.432V42.264C163.148 41.4 163.148 40.536 163.34 39.576ZM160.46 82.68C161.996 85.08 163.148 88.536 163.82 93.24C162.092 94.2 160.364 94.776 158.636 94.968C156.716 91.992 155.66 88.344 155.372 84.12C156.716 83.544 158.444 83.064 160.46 82.68ZM144.236 80.568C146.06 81.048 147.884 81.72 149.804 82.488C148.94 87.48 147.308 91.608 144.908 94.68C143.468 94.68 141.644 94.104 139.436 93.144C140.204 88.728 141.74 84.6 144.236 80.568ZM185.516 81.144C186.764 82.872 187.628 85.464 188.204 88.92C186.572 89.688 185.036 90.264 183.596 90.456C182.156 88.248 181.388 85.656 181.196 82.392C182.348 81.816 183.788 81.432 185.516 81.144ZM173.9 83.256C175.244 85.176 176.108 87.864 176.684 91.704C174.956 92.664 173.228 93.24 171.596 93.432C170.06 91.032 169.196 88.056 169.004 84.6C170.348 84.024 171.98 83.544 173.9 83.256Z"
                  fill="#bf83fc"
                />
                <path
                  d="M49.4272 72.7707C51.7454 72.1496 54.317 71.3611 57.2594 70.4733C56.9049 68.7793 56.5256 66.9927 56.2141 65.0884C50.811 66.4368 45.5867 67.3397 40.6339 67.7723C39.2775 66.0486 38.0121 62.8098 36.745 58.0806C35.7759 54.4642 34.1046 47.8556 31.8235 38.2299C32.5157 37.8457 33.486 37.3869 34.6915 37.0639C35.6188 36.8155 36.5958 36.7525 37.6655 36.6646C38.5599 40.0028 40.8392 48.1381 44.6886 61.0208C48.1941 60.3797 51.5821 59.6706 54.9451 58.8689C54.4597 56.3155 53.9495 53.6694 53.5071 50.9057C50.6756 51.4657 47.887 51.8153 45.1664 52.0474C44.6695 50.1928 44.4077 48.474 44.3811 46.8909C47.1199 46.3558 49.8587 45.8207 52.5976 45.2856C52.243 43.5917 51.9564 41.7801 51.6698 39.9686C53.6171 39.4468 55.6389 39.2032 57.6177 39.1699C57.9159 40.2827 58.2704 41.9766 58.774 44.227C60.8637 43.8658 62.9783 43.5974 65.068 43.2362C65.4656 44.7199 65.6098 46.3708 65.6431 48.3496C63.6958 48.8714 61.8412 49.3683 59.9369 49.6798C60.3726 52.0477 60.858 54.6011 61.418 57.4327C64.6205 56.7733 67.7732 55.9285 70.926 55.0838C70.8812 53.8037 70.5697 51.8995 69.8989 49.3958C68.7311 45.0375 67.3215 40.1478 65.6452 34.6337C53.5341 37.2826 45.9916 38.8066 43.0176 39.206C42.5224 38.8417 42.1564 37.8465 41.7589 36.3629C41.5352 35.5283 41.2868 34.601 41.2238 33.624C50.9173 31.2255 60.4071 29.1796 69.8357 27.6471C71.0945 30.4902 73.1865 37.1848 76.019 47.7559C77.311 52.5778 78.0697 56.1512 78.5054 58.5191C75.2666 59.7845 69.938 61.4111 62.6124 63.374C63.0166 65.2534 63.396 67.0401 63.7505 68.734L64.6778 68.4856C67.5524 67.7153 69.6421 67.3542 70.8972 67.2166C71.1888 67.9336 71.4803 68.6506 71.679 69.3924L72.3499 71.8961C71.9426 72.6015 69.8595 73.3585 66.0576 74.3772L64.7594 74.725C65.1703 77.0002 65.4636 79.2075 65.8247 81.2973C66.5666 81.0985 67.2157 80.9246 67.9575 80.7258C71.4812 79.7816 74.0346 79.2962 75.5679 79.0841C75.8346 79.7084 76.1261 80.4254 76.3746 81.3527L77.0454 83.8563C76.5454 84.5866 73.9987 85.4678 69.3622 86.7101C62.2221 88.6233 57.0723 89.8044 53.7953 90.1856C53.3184 89.5183 53.002 88.7086 52.7039 87.5958C52.4554 86.6685 52.2318 85.834 52.2185 85.0424C54.6294 84.3964 57.201 83.608 60.0756 82.8378C59.5289 80.7977 59.0253 78.5474 58.5218 76.297C55.2514 77.0739 52.698 77.5593 50.9792 77.8211C50.5023 77.1538 50.1611 76.2514 49.8877 75.2314C49.6393 74.3041 49.4405 73.5623 49.4272 72.7707ZM78.2067 31.0691C86.7013 29.3893 95.5736 28.0058 104.638 26.9685C104.951 30.363 105.029 33.6219 104.712 36.8874C104.745 38.8662 104.543 40.7092 104.199 42.3916C105.411 42.4644 106.505 42.4693 107.693 42.4493C107.862 44.193 107.778 46.1039 107.533 48.1572C100.633 49.1116 94.8137 49.2794 90.2615 48.6108C90.407 46.1865 90.6089 44.3435 90.8423 42.9889C93.1672 42.7635 95.3993 42.563 97.749 42.4303C98.1164 39.3503 98.3977 36.6908 98.4504 34.2914C91.3649 35.2955 84.9533 36.2184 79.1477 37.1777C78.5763 35.0449 78.2399 33.0479 78.2067 31.0691ZM98.9995 64.1591C103.11 73.195 105.783 79.8333 106.877 83.9134C105.357 84.917 103.577 85.6921 101.537 86.2388C98.9401 86.9345 96.5722 87.3702 94.4825 87.7313C93.5783 86.5822 93.045 85.3337 92.6971 84.0355C94.4523 83.1676 96.7208 82.361 99.5027 81.6156C97.5052 76.3864 95.6253 71.2251 93.863 66.1317C95.4327 65.3135 97.1449 64.656 98.9995 64.1591ZM112.328 50.8477C113.422 54.9278 113.983 59.2496 114.249 63.9491C112.58 64.3963 110.768 64.683 108.814 64.809C108.218 62.5835 107.924 60.3762 108.002 58.0695C99.5838 61.5178 90.4351 64.4661 80.6059 67.0999C79.9235 65.295 79.4762 63.6259 79.0787 62.1422C89.8086 57.6769 100.83 53.9287 112.328 50.8477Z"
                  fill="#bf83fc"
                />
              </svg>
            </div>
            <div tw="flex w-full">
              <div tw="flex justify-center w-full">
                <span
                  style={{
                    fontSize: "8rem",
                    lineHeight: "8rem",
                    letterSpacing: "-0.05em",
                    whiteSpace: "pre-wrap",
                    textWrap: "balance",
                  }}
                >
                  {title}
                </span>
              </div>
            </div>
            <div tw="flex px-8 py-4">
              <span
                style={{
                  fontSize: "2.5rem",
                  lineHeight: "4.5rem",
                  whiteSpace: "pre-wrap",
                  textWrap: "balance",
                }}
              >
                {siteConfig.description}
              </span>
            </div>
          </div>
        </div>
      </div>
    ),
    {
      width: 1920,
      height: 1080,
      fonts: [
        {
          name: "Inter",
          data: fontData,
          style: "normal",
        },
      ],
    }
  );
}
